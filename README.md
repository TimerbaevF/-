import spacy

    # Загрузка модели для русского языка
nlp = spacy.load("ru_core_news_sm")

def categorize_keywords(keywords):
    # Словарь категорий для ключевых слов
    categories = {
        "недовольство": "Эмоциональное выражение недовольства и разочарования.",
        "разочарование": "Эмоциональное выражение недовольства и разочарования.",
        "восхищение": "Эмоциональное выражение восхищения и уважения.",
        "уважение": "Эмоциональное выражение восхищения и уважения.",
        # Добавьте другие категории по необходимости
    }
    # Проверка каждого ключевого слова на принадлежность к категории
    for keyword in keywords:
        if keyword in categories:
            return categories[keyword]
    # Если ключевые слова не попали ни в одну категорию
    return "Эмоциональная нейтральность. Подтекст не вызывает явных эмоциональных реакций."

def generate_explanation(meaning):
    # Генерация объяснения на основе смысла
    if "недовольства и разочарования" in meaning.lower():
        return "Автор выражает негодование по отношению к чему-то в тексте."
    elif "восхищения и уважения" in meaning.lower():
        return "Автор выражает восхищение и уважение к объекту в тексте."
    else:
        return "Автор выражает эмоциональное отношение к объекту в тексте."

def analyze_subtext_in_dataset(dataset):
    # Анализ подтекста в датасете
    for idx, text in enumerate(dataset):
        # Обработка текста
        doc = nlp(text)
        # Поиск предложения с подтекстом
        subtext_sentence = next((sentence.text for sentence in doc.sents if any("подтекст" in token.text.lower() for token in sentence)), None)

        if subtext_sentence:
            # Выделение токенов в подтексте
            subtext_tokens = [token.text.lower() for token in nlp(subtext_sentence) if token.is_alpha and token.text.lower() not in ["подтекст"]]
            # Определение смысла на основе категорий ключевых слов
            meaning = categorize_keywords(subtext_tokens)
            # Автоматическое объяснение
            explanation = generate_explanation(meaning)

            print(f"\nАнализ текста {idx + 1}:")
            print("Подтекст: {}".format(subtext_sentence))
            print("Смысл: {}".format(meaning))
            print("Объяснение: {}".format(explanation))
        else:
            print(f"\nАнализ текста {idx + 1}:")
            print("Подтекст не найден в тексте.")

# Пример нового датасета и анализа
dataset = [
    "Текст с выражением глубокого недовольства и разочарования.",
    "В этом тексте скрыт подтекст, указывающий на сарказм.",
    "Просто информативный текст без эмоциональных подтекстов.",
    "Подтекст в тексте намекает на возможные опасности и создает тревожную атмосферу.",
    "Автор использует подтекст для создания таинственности и интриги.",
    "Текст выражает радость и положительное отношение к предстоящим событиям.",
    "В тексте присутствует подтекст, выражающий сомнение и неопределенность.",
    "Текст полон подтекстов, создающих атмосферу любви и нежности.",
    "Подтекст в этом тексте выражает восхищение и уважение.",
    "Этот текст ограничен только фактами и не несет эмоциональных подтекстов."
]

analyze_subtext_in_dataset(dataset)
